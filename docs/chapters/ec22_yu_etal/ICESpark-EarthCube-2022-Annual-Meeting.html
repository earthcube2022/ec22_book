
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>ICESpark-EarthCube-2022-Annual-Meeting &#8212; EarthCube 2022 Call for Notebooks</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="gallery" href="README.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.webp" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">EarthCube 2022 Call for Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  EarthCube 2022 Call
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../sources/index.html">
   EarthCube 2022 Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../sources/dois.html">
   Notebook DOIs
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Notebook Submissions
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_kwan_etal/README.html">
   Data Cleaning with Pandas and Jupyter Notebooks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_kwan_etal/notebooks/wyk_01_data_cleaning_with_pandas_and_jupyter_notebooks.html">
     Data Cleaning with Pandas and Jupyter Notebooks
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_ji_etal/README.html">
   Magnetic Polarity Inversion Line Detection and Analysis Tool
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_ji_etal/AJ_01_MPIL_Detection_and_Analysis_Tool.html">
     AJ_01_MPIL_Detection_and_Analysis_Tool
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_abduallah_etal/README.html">
   Predicting Solar Flares with Machine Learning
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_abduallah_etal/YA_01_PredictingSolarFlareswithMachineLearning.html">
     <strong>
      Predicting Solar Flares with Machine Learning
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_khider_etal/README.html">
   PaleoHack: Putting EarthCube tools in the hands of paleogeoscientists
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_khider_etal/DK_v1_PaleoHack.html">
     PaleoHack: Putting EarthCube tools in the hands of paleogeoscientists
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_markowsky_etal/README.html">
   Visualizing Ice Core Datasets in Python Using a Jupyter Notebook Template
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_markowsky_etal/LM_01_Visualizing_Ice_Core_Datasets_in_Python_Using_a_Jupyter_Notebook_Template.html">
     Visualizing Ice Core Datasets in Python Using a Jupyter Notebook Template
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ec22_mckay_etal/README.html">
   Database interoperability, uncertainty quantification and reproducible workflows in the paleogeosciences
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_mills_etal/README.html">
   Intro to Argovis' API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_mills_etal/WM_01_intro_to_argovis_api.html">
     Intro to Argovis’ API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_mirkovich_etal/README.html">
   Assimilative Mapping of Geospace Observations (AMGeO)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_mirkovich_etal/WM_02_AMGeO-2.0.html">
     AMGeO 2.0: Crafting an API for Geospace Data Scientists
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_miron_etal/README.html">
   Accelerating Lagrangian analyses of oceanic data: benchmarking typical workflows
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_miron_etal/PM_05_Accelerating_Lagrangian_analyses_of_oceanic_data_benchmarking_typical_workflows.html">
     Accelerating Lagrangian analyses of oceanic data: benchmarking typical workflows
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_okeefe_etal/README.html">
   Handling Highly Imbalanced Data in Machine Learning Applications
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_okeefe_etal/PO_02_Handling_Highly_Imbalanced_Data_in_Machine_Learning_Applications.html">
     Handling Highly Imbalanced Data in Machine Learning Applications
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_rotti_etal/README.html">
   EC_SEP_Visualization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_rotti_etal/SR_01_GSEP_events_catalog_and_time_series_dataset.html">
     GSEP Event Catalog and Time Series Dataset
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec22_tauxe_etal/README.html">
   Jupyter Notebooks as a bridge to the MagIC Database and Open Science
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec22_tauxe_etal/2022_MagIC_database_and_open_science.html">
     Jupyter Notebooks as a bridge to the MagIC Database and Open Science
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="README.html">
   ICESpark
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     ICESpark-EarthCube-2022-Annual-Meeting
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/chapters/ec22_yu_etal/ICESpark-EarthCube-2022-Annual-Meeting.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   ICESpark-EarthCube-2022-Annual-Meeting
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authors">
     Authors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#table-of-contents">
     Table of Contents
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purpose">
     Purpose
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#technical-contributions">
     Technical contributions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     Results
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#funding">
     Funding
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keywords">
     Keywords
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#library-import">
     Library import
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialize-the-cluster-environment">
     Initialize the cluster environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#register-geospatial-data-support">
     Register geospatial data support
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-import">
   Data import
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-ice-sat2-orbits-into-spark">
     Load ICE_SAT2 orbits into Spark
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-dataframe-with-a-geometry-column">
     Create DataFrame with a Geometry column
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-a-country-shapefile-as-the-base-map-for-visualization-purpose">
     Read a country shapefile as the base map, for visualization purpose
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#demo-1-find-the-crossings-between-icesat-2-orbits-and-soda-moorings">
   Demo 1: Find the crossings between ICESat-2 orbits and SODA moorings
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-the-crossings-around-three-soda-objects-each-of-which-has-a-100km-buffer-area-using-st-buffer">
     Find the crossings around three SODA objects, each of which has a 100KM buffer area, using ST_Buffer
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-orbits-in-year-2019-in-the-soda-c-result">
     Find orbits in Year 2019 in the SODA-C result
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-crossings-on-soda-c-using-geopandas">
     Visualize crossings on SODA-C using GeoPandas
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#put-soda-c-into-a-df-and-convert-it-to-100km-circle">
       Put SODA-C into a DF and convert it to 100KM circle
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-soda-c-result-dataframe-to-geopandas-dataframe">
       Convert SODA-C result DataFrame to GeoPandas DataFrame
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-the-maps">
       Plot the maps
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#demo-2-find-the-crossing-between-icesat-2-orbits-and-sentinel-2-and-worldview-3-images">
   Demo 2:  Find the crossing between ICESat-2 orbits and Sentinel-2 and WorldView-3 images
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-if-orbits-intersect-s-2-and-or-worldview-bounding-boxes">
     Check if orbits intersect S-2 and/or WorldView bounding boxes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-orbits-in-year-2019-in-the-s-2-a-result">
     Find orbits in Year 2019 in the S-2 A result
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-crossings-on-s-2-a-using-geopandas">
     Visualize crossings on S-2 A using GeoPandas
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#put-s-2-a-into-a-dataframe">
       Put S-2 A into a DataFrame
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-result-dataframe-to-geopandas-dataframe">
       Convert result DataFrame to GeoPandas DataFrame
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Plot the maps
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#demo-3-find-the-crossings-between-icesat-2-orbits-and-mosaic-master-track-of-polarstern-cruise">
   Demo 3: Find the crossings between ICESat-2 orbits and MOSAiC Master track of POLARSTERN cruise
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-master-track-of-polarstern-cruise-into-spark">
     Load Master track of POLARSTERN cruise into Spark
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-dataframe-with-a-geometry-column">
     Create a DataFrame with a Geometry column
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-orbits-within-a-50km-circle-of-cruise-locations-in-year-2019-using-st-buffer">
     Find orbits within a 50KM circle of cruise locations in Year 2019, using ST_Buffer
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-the-query-result-using-geopandas">
     Visualize the query result using GeoPandas
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-cruise-df-to-50km-circle">
       Convert Cruise DF to 50KM circle
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-to-geopandas-dataframes">
       Convert to GeoPandas DataFrames
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Plot the maps
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>ICESpark-EarthCube-2022-Annual-Meeting</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   ICESpark-EarthCube-2022-Annual-Meeting
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authors">
     Authors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#table-of-contents">
     Table of Contents
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purpose">
     Purpose
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#technical-contributions">
     Technical contributions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     Results
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#funding">
     Funding
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keywords">
     Keywords
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#library-import">
     Library import
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialize-the-cluster-environment">
     Initialize the cluster environment
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#register-geospatial-data-support">
     Register geospatial data support
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-import">
   Data import
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-ice-sat2-orbits-into-spark">
     Load ICE_SAT2 orbits into Spark
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-dataframe-with-a-geometry-column">
     Create DataFrame with a Geometry column
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-a-country-shapefile-as-the-base-map-for-visualization-purpose">
     Read a country shapefile as the base map, for visualization purpose
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#demo-1-find-the-crossings-between-icesat-2-orbits-and-soda-moorings">
   Demo 1: Find the crossings between ICESat-2 orbits and SODA moorings
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-the-crossings-around-three-soda-objects-each-of-which-has-a-100km-buffer-area-using-st-buffer">
     Find the crossings around three SODA objects, each of which has a 100KM buffer area, using ST_Buffer
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-orbits-in-year-2019-in-the-soda-c-result">
     Find orbits in Year 2019 in the SODA-C result
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-crossings-on-soda-c-using-geopandas">
     Visualize crossings on SODA-C using GeoPandas
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#put-soda-c-into-a-df-and-convert-it-to-100km-circle">
       Put SODA-C into a DF and convert it to 100KM circle
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-soda-c-result-dataframe-to-geopandas-dataframe">
       Convert SODA-C result DataFrame to GeoPandas DataFrame
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-the-maps">
       Plot the maps
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#demo-2-find-the-crossing-between-icesat-2-orbits-and-sentinel-2-and-worldview-3-images">
   Demo 2:  Find the crossing between ICESat-2 orbits and Sentinel-2 and WorldView-3 images
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-if-orbits-intersect-s-2-and-or-worldview-bounding-boxes">
     Check if orbits intersect S-2 and/or WorldView bounding boxes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-orbits-in-year-2019-in-the-s-2-a-result">
     Find orbits in Year 2019 in the S-2 A result
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-crossings-on-s-2-a-using-geopandas">
     Visualize crossings on S-2 A using GeoPandas
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#put-s-2-a-into-a-dataframe">
       Put S-2 A into a DataFrame
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-result-dataframe-to-geopandas-dataframe">
       Convert result DataFrame to GeoPandas DataFrame
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Plot the maps
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#demo-3-find-the-crossings-between-icesat-2-orbits-and-mosaic-master-track-of-polarstern-cruise">
   Demo 3: Find the crossings between ICESat-2 orbits and MOSAiC Master track of POLARSTERN cruise
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-master-track-of-polarstern-cruise-into-spark">
     Load Master track of POLARSTERN cruise into Spark
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-dataframe-with-a-geometry-column">
     Create a DataFrame with a Geometry column
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-orbits-within-a-50km-circle-of-cruise-locations-in-year-2019-using-st-buffer">
     Find orbits within a 50KM circle of cruise locations in Year 2019, using ST_Buffer
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-the-query-result-using-geopandas">
     Visualize the query result using GeoPandas
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-cruise-df-to-50km-circle">
       Convert Cruise DF to 50KM circle
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-to-geopandas-dataframes">
       Convert to GeoPandas DataFrames
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Plot the maps
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="icespark-earthcube-2022-annual-meeting">
<h1>ICESpark-EarthCube-2022-Annual-Meeting<a class="headerlink" href="#icespark-earthcube-2022-annual-meeting" title="Permalink to this headline">#</a></h1>
<p>ICESpark in Action: Analyzing Large-scale Arctic Observations Using an Open-source Big Data Platform</p>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Author1 = {“name”: “Jia Yu”, “affiliation”: “Washington State University”, “email”: “<a class="reference external" href="mailto:jia&#46;yu1&#37;&#52;&#48;wsu&#46;edu">jia<span>&#46;</span>yu1<span>&#64;</span>wsu<span>&#46;</span>edu</a>”}</p></li>
<li><p>Author2 = {“name”: “Yiqun Xie”, “affiliation”: “University of Maryland”, “email”: “<a class="reference external" href="mailto:xie&#37;&#52;&#48;umd&#46;edu">xie<span>&#64;</span>umd<span>&#46;</span>edu</a>”}</p></li>
<li><p>Author3 = {“name”: “Kyle Duncan”, “affiliation”: “University of Maryland”, “email”: “<a class="reference external" href="mailto:kduncan&#37;&#52;&#48;umd&#46;edu">kduncan<span>&#64;</span>umd<span>&#46;</span>edu</a>”}</p></li>
<li><p>Author4 = {“name”: “Sinead Louise Farrell”, “affiliation”: “University of Maryland”, “email”: “<a class="reference external" href="mailto:sineadf&#37;&#52;&#48;umd&#46;edu">sineadf<span>&#64;</span>umd<span>&#46;</span>edu</a>”}</p></li>
</ul>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#ICESpark-EarthCube-2022-Annual-Meeting">ICESpark-EarthCube-2022-Annual-Meeting</a></p></li>
<li><p><a class="reference external" href="#Setup">Setup</a></p></li>
<li><p><a class="reference external" href="#Data-import">Data import</a></p></li>
<li><p><a class="reference external" href="#Demo-1:-Find-the-crossings-between-ICESat-2-orbits-and-SODA-moorings">Demo 1: Find the crossings between ICESat-2 orbits and SODA moorings </a></p></li>
<li><p><a class="reference external" href="#Demo-2:--Find-the-crossing-between-ICESat-2-orbits-and-Sentinel-2-and-WorldView-3-images">Demo 2:  Find the crossing between ICESat-2 orbits and Sentinel-2 and WorldView-3 images</a></p></li>
<li><p><a class="reference external" href="#Demo-3:-Find-the-crossings-between-ICESat-2-orbits-and-MOSAiC-Master-track-of-POLARSTERN-cruise">Demo 3: Find the crossings between ICESat-2 orbits and MOSAiC Master track of POLARSTERN cruise</a></p></li>
<li><p><a class="reference external" href="#References">References</a></p></li>
</ol>
</section>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">#</a></h2>
<p>The Arctic climate system is undergoing rapid change with rising air and sea surface temperatures, accompanied by declines in Arctic glacial ice and sea ice as well as loss of snow cover on land. The combined increase in global air temperature and ice-sheet mass loss is driving sea level rise around the globe. As the Arctic region is largely inaccessible to traditional observation techniques, satellite remote sensing systems play a key role in monitoring the essential climate variables. However, the unprecedented volume and variety of geospatial big data collected by new satellite sensors have reached far beyond the capacity of computing platforms accessible to most geoscientists. ICESpark is an open-source distributed platform that can combine local commodity computers into a powerful environment that is ready for geospatial big data (GeoBD). Built on Apache Sedona [1], ICESpark comprises a set of off-the-shelf data integration tools and analytical functions to make sense of large-scale arctic observations.</p>
</section>
<section id="technical-contributions">
<h2>Technical contributions<a class="headerlink" href="#technical-contributions" title="Permalink to this headline">#</a></h2>
<p>We plan to demonstrate ICESpark through a Python Jupyter notebook running on top of a cluster of commodity computers to let the audience experience the scalability and interactivity provided by the tool. In this notebook, we demonstrate three case studies to illustrate how ICESpark may help geoscientists quickly find temporally and/or spatially coincident data across heterogenous arctic observation data. This task is typically required to validate the accuracy of new remote sensing data products, or for cross comparison of complementary polar climate variables.</p>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>The first case study includes Stratified Ocean Dynamics of the Arctic (SODA) moorings [2] and ICESat-2 reference ground tracks (RGTs) [3], where the goal is to find all ICESat-2 orbits falling within a 50 km search radius around the mooring sites.</p></li>
<li><p>The second case study integrates Sentinel-2 [4] and WorldView-3 [5] imagery to discover the spatial overlaps between ICESat-2 RGTs and tiles from these high-resolution imagery datasets.</p></li>
<li><p>The last case study compares the aforementioned lCESat 2 orbits (RGTs) against the MOSAiC expedition cruise master track data [6 - 9]. The goal of this study is to find the spatio-temporal overalps between ICESat-Z orbits and a 50KM search radius around each reported cruise location.</p></li>
</ul>
</section>
<section id="funding">
<h2>Funding<a class="headerlink" href="#funding" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Award1 = {“agency”: “US National Science Foundation”, “award_code”: “2126449”, “award_URL”: “<a class="reference external" href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2126449&amp;HistoricalAwards=false">https://www.nsf.gov/awardsearch/showAward?AWD_ID=2126449&amp;HistoricalAwards=false</a>”}</p></li>
<li><p>Award2 = {“agency”: “US National Science Foundation”, “award_code”: “2126474”, “award_URL”: “<a class="reference external" href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2126474&amp;HistoricalAwards=false">https://www.nsf.gov/awardsearch/showAward?AWD_ID=2126474&amp;HistoricalAwards=false</a>”}</p></li>
</ul>
</section>
<section id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">#</a></h2>
<p>keywords=[“arctic observation”, “big data”, “cluster computing”]</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h1>
<section id="library-import">
<h2>Library import<a class="headerlink" href="#library-import" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Import local library</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1">## Import GeoPandas</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="c1">## Import PySpark</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">broadcast</span><span class="p">,</span> <span class="n">udf</span>

<span class="c1">## Import Apache Sedona</span>
<span class="kn">from</span> <span class="nn">sedona.register</span> <span class="kn">import</span> <span class="n">SedonaRegistrator</span>
<span class="kn">from</span> <span class="nn">sedona.utils</span> <span class="kn">import</span> <span class="n">SedonaKryoRegistrator</span><span class="p">,</span> <span class="n">KryoSerializer</span>
<span class="kn">from</span> <span class="nn">sedona.core.formatMapper.shapefileParser</span> <span class="kn">import</span> <span class="n">ShapefileReader</span>
<span class="kn">from</span> <span class="nn">sedona.utils.adapter</span> <span class="kn">import</span> <span class="n">Adapter</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="initialize-the-cluster-environment">
<h2>Initialize the cluster environment<a class="headerlink" href="#initialize-the-cluster-environment" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span> \
    <span class="n">builder</span><span class="o">.</span> \
    <span class="n">appName</span><span class="p">(</span><span class="s1">&#39;appName&#39;</span><span class="p">)</span><span class="o">.</span> \
    <span class="n">master</span><span class="p">(</span><span class="s1">&#39;local[*]&#39;</span><span class="p">)</span><span class="o">.</span> \
    <span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.serializer&quot;</span><span class="p">,</span> <span class="n">KryoSerializer</span><span class="o">.</span><span class="n">getName</span><span class="p">)</span><span class="o">.</span> \
    <span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.kryo.registrator&quot;</span><span class="p">,</span> <span class="n">SedonaKryoRegistrator</span><span class="o">.</span><span class="n">getName</span><span class="p">)</span><span class="o">.</span> \
    <span class="n">config</span><span class="p">(</span><span class="s1">&#39;spark.jars.packages&#39;</span><span class="p">,</span>
           <span class="s1">&#39;org.apache.sedona:sedona-python-adapter-3.0_2.12:1.2.0-incubating,org.datasyslab:geotools-wrapper:1.1.0-25.2&#39;</span><span class="p">)</span><span class="o">.</span> \
    <span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22/04/20 19:52:15 WARN Utils: Your hostname, jia-imac.local resolves to a loopback address: 127.0.0.1; using 10.71.12.51 instead (on interface en0)
22/04/20 19:52:15 WARN Utils: Set SPARK_LOCAL_IP if you need to bind to another address
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.apache.spark.unsafe.Platform (file:/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/pyspark/jars/spark-unsafe_2.12-3.1.2.jar) to constructor java.nio.DirectByteBuffer(long,int)
WARNING: Please consider reporting this to the maintainers of org.apache.spark.unsafe.Platform
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>:: loading settings :: url = jar:file:/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/pyspark/jars/ivy-2.4.0.jar!/org/apache/ivy/core/settings/ivysettings.xml
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ivy Default Cache set to: /Users/jiayu/.ivy2/cache
The jars for the packages stored in: /Users/jiayu/.ivy2/jars
org.apache.sedona#sedona-python-adapter-3.0_2.12 added as a dependency
org.datasyslab#geotools-wrapper added as a dependency
:: resolving dependencies :: org.apache.spark#spark-submit-parent-22c315bb-e727-425e-b708-18068977ffae;1.0
	confs: [default]
	found org.apache.sedona#sedona-python-adapter-3.0_2.12;1.2.0-incubating in central
	found org.locationtech.jts#jts-core;1.18.0 in local-m2-cache
	found org.wololo#jts2geojson;0.16.1 in local-m2-cache
	found com.fasterxml.jackson.core#jackson-databind;2.12.2 in local-m2-cache
	found com.fasterxml.jackson.core#jackson-annotations;2.12.2 in local-m2-cache
	found com.fasterxml.jackson.core#jackson-core;2.12.2 in local-m2-cache
	found org.apache.sedona#sedona-core-3.0_2.12;1.2.0-incubating in local-m2-cache
	found org.scala-lang.modules#scala-collection-compat_2.12;2.5.0 in local-m2-cache
	found org.apache.sedona#sedona-sql-3.0_2.12;1.2.0-incubating in local-m2-cache
	found org.datasyslab#geotools-wrapper;1.1.0-25.2 in local-m2-cache
:: resolution report :: resolve 247ms :: artifacts dl 5ms
	:: modules in use:
	com.fasterxml.jackson.core#jackson-annotations;2.12.2 from local-m2-cache in [default]
	com.fasterxml.jackson.core#jackson-core;2.12.2 from local-m2-cache in [default]
	com.fasterxml.jackson.core#jackson-databind;2.12.2 from local-m2-cache in [default]
	org.apache.sedona#sedona-core-3.0_2.12;1.2.0-incubating from local-m2-cache in [default]
	org.apache.sedona#sedona-python-adapter-3.0_2.12;1.2.0-incubating from central in [default]
	org.apache.sedona#sedona-sql-3.0_2.12;1.2.0-incubating from local-m2-cache in [default]
	org.datasyslab#geotools-wrapper;1.1.0-25.2 from local-m2-cache in [default]
	org.locationtech.jts#jts-core;1.18.0 from local-m2-cache in [default]
	org.scala-lang.modules#scala-collection-compat_2.12;2.5.0 from local-m2-cache in [default]
	org.wololo#jts2geojson;0.16.1 from local-m2-cache in [default]
	:: evicted modules:
	org.locationtech.jts#jts-core;1.18.1 by [org.locationtech.jts#jts-core;1.18.0] in [default]
	---------------------------------------------------------------------
	|                  |            modules            ||   artifacts   |
	|       conf       | number| search|dwnlded|evicted|| number|dwnlded|
	---------------------------------------------------------------------
	|      default     |   11  |   0   |   0   |   1   ||   10  |   0   |
	---------------------------------------------------------------------
:: retrieving :: org.apache.spark#spark-submit-parent-22c315bb-e727-425e-b708-18068977ffae
	confs: [default]
	0 artifacts copied, 10 already retrieved (0kB/7ms)
22/04/20 19:52:16 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Using Spark&#39;s default log4j profile: org/apache/spark/log4j-defaults.properties
Setting default log level to &quot;WARN&quot;.
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
</pre></div>
</div>
</div>
</div>
</section>
<section id="register-geospatial-data-support">
<h2>Register geospatial data support<a class="headerlink" href="#register-geospatial-data-support" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SedonaRegistrator</span><span class="o">.</span><span class="n">registerAll</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span>
<span class="n">sc</span><span class="o">.</span><span class="n">setSystemProperty</span><span class="p">(</span><span class="s2">&quot;sedona.global.charset&quot;</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Stage 0:&gt;                                                          (0 + 1) / 1]

                                                                                
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-import">
<h1>Data import<a class="headerlink" href="#data-import" title="Permalink to this headline">#</a></h1>
<section id="load-ice-sat2-orbits-into-spark">
<h2>Load ICE_SAT2 orbits into Spark<a class="headerlink" href="#load-ice-sat2-orbits-into-spark" title="Permalink to this headline">#</a></h2>
<p>Files are originally in KML. They are converted to a single WKT file using GDAL ogr2ogr command.</p>
<p>The converted dataset contains 13704 orbits and has 2.6GB in size. The notebook only takes a sample of 499 orbits because of the limited resource provided in Binder environment. In addition, GitHub only allows max 100MB per file.</p>
<p>Filename example: IS2_RGT_0702_cycle3_14-May-2019.kml.csv</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">orbit_date</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
  <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
  <span class="n">date_str</span> <span class="o">=</span> <span class="n">s</span><span class="p">[(</span><span class="n">length</span><span class="o">-</span><span class="mi">19</span><span class="p">):(</span><span class="n">length</span><span class="o">-</span><span class="mi">8</span><span class="p">)]</span>
  <span class="n">date_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%b-%Y&#39;</span><span class="p">)</span>
<span class="c1">#   return date_obj.strftime(&quot;%Y-%m-%d&quot;)</span>
  <span class="k">return</span> <span class="n">date_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m&quot;</span><span class="p">)</span>

<span class="c1"># Add date UDF</span>
<span class="n">spark</span><span class="o">.</span><span class="n">udf</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;orbit_date&quot;</span><span class="p">,</span> <span class="n">orbit_date</span><span class="p">)</span>

<span class="c1"># Load data and create a Date column</span>
<span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;csv&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">option</span><span class="p">(</span><span class="s2">&quot;delimiter&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">option</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/IS2_RGTs_aggr_data_timestamp-head500.csv&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="s2">&quot;orbit_date(filename)&quot;</span><span class="p">))</span><span class="o">.</span>\
    <span class="n">repartition</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;is2_df_raw&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-dataframe-with-a-geometry-column">
<h2>Create DataFrame with a Geometry column<a class="headerlink" href="#create-dataframe-with-a-geometry-column" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;select ST_FlipCoordinates(ST_GeomFromWKT(WKT)) as orbit, Name, altitudeMode, tessellate, extrude, visibility, filename, date from is2_df_raw&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;is2_df&quot;</span><span class="p">)</span>

<span class="c1">## Show the schema of the table</span>
<span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;is2_df&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">## Show the names of the orbits</span>
<span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;is2_df&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1">## Print the count. The total count should be 499</span>
<span class="nb">print</span><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;is2_df&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------+-----+-------------+----------+-------+----------+--------------------+-------+
|               orbit| Name| altitudeMode|tessellate|extrude|visibility|            filename|   date|
+--------------------+-----+-------------+----------+-------+----------+--------------------+-------+
|LINESTRING (0.027...|RGT 1|clampToGround|        -1|      0|         1|IS2_RGT_0001_cycl...|2019-03|
|LINESTRING (0.027...|RGT 1|clampToGround|        -1|      0|         1|IS2_RGT_0001_cycl...|2020-06|
+--------------------+-----+-------------+----------+-------+----------+--------------------+-------+
only showing top 2 rows

+----------------------------------------+
|filename                                |
+----------------------------------------+
|IS2_RGT_0003_cycle10_24-Dec-2020.kml.csv|
|IS2_RGT_0003_cycle11_25-Mar-2021.kml.csv|
|IS2_RGT_0005_cycle2_28-Dec-2018.kml.csv |
|IS2_RGT_0005_cycle7_26-Mar-2020.kml.csv |
|IS2_RGT_0004_cycle2_28-Dec-2018.kml.csv |
|IS2_RGT_0006_cycle2_28-Dec-2018.kml.csv |
|IS2_RGT_0006_cycle5_27-Sep-2019.kml.csv |
|IS2_RGT_0006_cycle8_25-Jun-2020.kml.csv |
|IS2_RGT_0009_29-Dec-2018.kml.csv        |
|IS2_RGT_0010_29-Dec-2018.kml.csv        |
+----------------------------------------+
only showing top 10 rows

499
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-a-country-shapefile-as-the-base-map-for-visualization-purpose">
<h2>Read a country shapefile as the base map, for visualization purpose<a class="headerlink" href="#read-a-country-shapefile-as-the-base-map-for-visualization-purpose" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">countries</span> <span class="o">=</span> <span class="n">ShapefileReader</span><span class="o">.</span><span class="n">readToGeometryRDD</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s2">&quot;data/ne_50m_admin_0_countries_lakes&quot;</span><span class="p">)</span>
<span class="n">countries_df</span> <span class="o">=</span> <span class="n">Adapter</span><span class="o">.</span><span class="n">toDf</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="n">spark</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;NAME_EN&quot;</span><span class="p">)</span>
<span class="n">countries_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22/04/20 19:52:24 WARN package: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting &#39;spark.sql.debug.maxToStringFields&#39;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------+--------------------+
|            geometry|             NAME_EN|
+--------------------+--------------------+
|MULTIPOLYGON (((3...|Zimbabwe         ...|
|MULTIPOLYGON (((3...|Zambia           ...|
+--------------------+--------------------+
only showing top 2 rows
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="demo-1-find-the-crossings-between-icesat-2-orbits-and-soda-moorings">
<h1>Demo 1: Find the crossings between ICESat-2 orbits and SODA moorings<a class="headerlink" href="#demo-1-find-the-crossings-between-icesat-2-orbits-and-soda-moorings" title="Permalink to this headline">#</a></h1>
<p>We have 3 Stratified Ocean Dynamics of the Arctic (SODA) moorings sites at the following locations:</p>
<p>SODA-A: (73.00043, -148.33627)</p>
<p>SODA-B: (75.46388, -145.63685)</p>
<p>SODA-C: (77.73677, -139.14153)</p>
<section id="find-the-crossings-around-three-soda-objects-each-of-which-has-a-100km-buffer-area-using-st-buffer">
<h2>Find the crossings around three SODA objects, each of which has a 100KM buffer area, using ST_Buffer<a class="headerlink" href="#find-the-crossings-around-three-soda-objects-each-of-which-has-a-100km-buffer-area-using-st-buffer" title="Permalink to this headline">#</a></h2>
<p>IceSat2 data needs to be converted from WGS84 (epsg:4326) CRS to meter-based epsg:4087 (WGS 84 / World Equidistant Cylindrical) using Sedona’s ST_Transform</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_df1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;SELECT * &#39;</span>
                     <span class="s1">&#39;FROM is2_df &#39;</span>
                     <span class="s1">&#39;WHERE ST_Intersects(ST_Buffer(ST_Transform(ST_POINT (73.00043,-148.33627), </span><span class="se">\&#39;</span><span class="s1">epsg:4326</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">epsg:4087</span><span class="se">\&#39;</span><span class="s1">), 100000), ST_Transform(orbit, </span><span class="se">\&#39;</span><span class="s1">epsg:4326</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">epsg:4087</span><span class="se">\&#39;</span><span class="s1">))&#39;</span><span class="p">)</span>
<span class="n">result_df1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SODA-A crosses: &#39;</span><span class="p">,</span> <span class="n">result_df1</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

<span class="n">result_df2</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;SELECT * &#39;</span>
                     <span class="s1">&#39;FROM is2_df &#39;</span>
                     <span class="s1">&#39;WHERE ST_Intersects(ST_Buffer(ST_Transform(ST_POINT (75.46388,-145.63685), </span><span class="se">\&#39;</span><span class="s1">epsg:4326</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">epsg:4087</span><span class="se">\&#39;</span><span class="s1">), 100000), ST_Transform(orbit, </span><span class="se">\&#39;</span><span class="s1">epsg:4326</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">epsg:4087</span><span class="se">\&#39;</span><span class="s1">))&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SODA-B crosses: &#39;</span><span class="p">,</span> <span class="n">result_df2</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

<span class="n">result_df3</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;SELECT * &#39;</span>
                     <span class="s1">&#39;FROM is2_df &#39;</span>
                     <span class="s1">&#39;WHERE ST_Intersects(ST_Buffer(ST_Transform(ST_POINT (77.73677, -139.14153), </span><span class="se">\&#39;</span><span class="s1">epsg:4326</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">epsg:4087</span><span class="se">\&#39;</span><span class="s1">), 100000), ST_Transform(orbit, </span><span class="se">\&#39;</span><span class="s1">epsg:4326</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">epsg:4087</span><span class="se">\&#39;</span><span class="s1">))&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SODA-C crosses: &#39;</span><span class="p">,</span> <span class="n">result_df3</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------+------+-------------+----------+-------+----------+--------------------+-------+
|               orbit|  Name| altitudeMode|tessellate|extrude|visibility|            filename|   date|
+--------------------+------+-------------+----------+-------+----------+--------------------+-------+
|LINESTRING (0.025...|RGT 22|clampToGround|        -1|      0|         1|IS2_RGT_0022_cycl...|2020-03|
|LINESTRING (0.025...|RGT 22|clampToGround|        -1|      0|         1|IS2_RGT_0022_cycl...|2020-09|
+--------------------+------+-------------+----------+-------+----------+--------------------+-------+
only showing top 2 rows
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SODA-A crosses:  10
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SODA-B crosses:  0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Stage 23:==&gt;                                                     (1 + 19) / 20]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SODA-C crosses:  10
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Stage 23:================&gt;                                       (6 + 14) / 20]

                                                                                
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-orbits-in-year-2019-in-the-soda-c-result">
<h2>Find orbits in Year 2019 in the SODA-C result<a class="headerlink" href="#find-orbits-in-year-2019-in-the-soda-c-result" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_df3_sorted</span> <span class="o">=</span> <span class="n">result_df3</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;filename LIKE </span><span class="se">\&#39;</span><span class="si">%2019%</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span>
<span class="n">result_df3_sorted</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---------------------------------------+
|filename                               |
+---------------------------------------+
|IS2_RGT_0008_cycle3_29-Mar-2019.kml.csv|
|IS2_RGT_0008_cycle5_27-Sep-2019.kml.csv|
|IS2_RGT_0008_cycle6_27-Dec-2019.kml.csv|
+---------------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-crossings-on-soda-c-using-geopandas">
<h2>Visualize crossings on SODA-C using GeoPandas<a class="headerlink" href="#visualize-crossings-on-soda-c-using-geopandas" title="Permalink to this headline">#</a></h2>
<section id="put-soda-c-into-a-df-and-convert-it-to-100km-circle">
<h3>Put SODA-C into a DF and convert it to 100KM circle<a class="headerlink" href="#put-soda-c-into-a-df-and-convert-it-to-100km-circle" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soda_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;POINT (73.00043 -148.33627)&quot;</span><span class="p">,</span> <span class="s2">&quot;POINT (75.46388 -145.63685)&quot;</span><span class="p">,</span> <span class="s2">&quot;POINT (77.73677 -139.14153)&quot;</span><span class="p">]</span>
<span class="c1"># soda_list = [&quot;POINT (77.73677 -139.14153)&quot;]</span>
<span class="n">soda_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">soda_list</span><span class="p">,</span><span class="n">StringType</span><span class="p">())</span>
<span class="c1"># Convert to epsg:4087 meter-based CRS</span>
<span class="n">soda_df</span> <span class="o">=</span> <span class="n">soda_df</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s1">&#39;ST_Transform(ST_GeomFromWKT(value), </span><span class="se">\&#39;</span><span class="s1">epsg:4326</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">epsg:3413</span><span class="se">\&#39;</span><span class="s1">) as is2_df&#39;</span><span class="p">)</span>
<span class="n">soda_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># Create circles using 50KM</span>
<span class="n">soda_df</span> <span class="o">=</span> <span class="n">soda_df</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s1">&#39;ST_Buffer(is2_df, 100000) as is2_df&#39;</span><span class="p">)</span>
<span class="c1"># Convert to epsg:4326 WGS84</span>
<span class="n">soda_df</span> <span class="o">=</span> <span class="n">soda_df</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s1">&#39;ST_FlipCoordinates(ST_Transform(is2_df, </span><span class="se">\&#39;</span><span class="s1">epsg:3413</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">epsg:4326</span><span class="se">\&#39;</span><span class="s1">)) as is2_df&#39;</span><span class="p">)</span>
<span class="c1"># soda_df.show()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------+
|              is2_df|
+--------------------+
|POINT (-1804587.9...|
|POINT (-1555620.5...|
|POINT (-1329850.8...|
+--------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-soda-c-result-dataframe-to-geopandas-dataframe">
<h3>Convert SODA-C result DataFrame to GeoPandas DataFrame<a class="headerlink" href="#convert-soda-c-result-dataframe-to-geopandas-dataframe" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">countries_df</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
<span class="n">soda_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">soda_df</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;is2_df&quot;</span><span class="p">)</span>
<span class="n">orbit_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">result_df3</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s1">&#39;ST_FlipCoordinates(orbit) as orbit&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;orbit&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/array.py:85: ShapelyDeprecationWarning: __len__ for multi-part geometries is deprecated and will be removed in Shapely 2.0. Check the length of the `geoms` property instead to get the  number of parts of a multi-part geometry.
  aout[:] = out
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/geodataframe.py:35: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  out = from_shapely(data)
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-the-maps">
<h3>Plot the maps<a class="headerlink" href="#plot-the-maps" title="Permalink to this headline">#</a></h3>
<p>You can uncomment different base XY to change the view of the map</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base</span> <span class="o">=</span> <span class="n">country_gpd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#d7fffe&#39;</span><span class="p">)</span>
<span class="c1"># SODA-A Close-up view</span>
<span class="c1">#base.set_xlim(-151, -146)</span>
<span class="c1">#base.set_ylim(71, 75)</span>
<span class="c1"># SODA-B Close-up view</span>
<span class="c1">#base.set_xlim(-147.5, -143.5)</span>
<span class="c1">#base.set_ylim(74, 77)</span>
<span class="c1"># SODA-C Close-up view</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="o">-</span><span class="mi">130</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="c1"># SODA-ABC Close-up view</span>
<span class="c1"># base.set_xlim(-160, -130)</span>
<span class="c1"># base.set_ylim(60, 90)</span>
<span class="c1"># Global view</span>
<span class="c1"># base.set_xlim(-180, 180)</span>
<span class="c1"># base.set_ylim(-90, 90)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude (degrees)&#39;</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude (degrees)&#39;</span><span class="p">)</span>
<span class="n">orbit</span> <span class="o">=</span> <span class="n">orbit_gpd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#06470c&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">soda</span> <span class="o">=</span> <span class="n">soda_gpd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">orbit</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/plotting.py:38: ShapelyDeprecationWarning: Iteration over multi-part geometries is deprecated and will be removed in Shapely 2.0. Use the `geoms` property to access the constituent parts of a multi-part geometry.
  for poly in geom:
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  vertices = concatenate([
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/descartes/patch.py:64: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  [asarray(r)[:, :2] for r in t.interiors])
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/plotting.py:171: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  segments = [np.array(linestring)[:, :2] for linestring in geoms]
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  vertices = concatenate([
</pre></div>
</div>
<img alt="../../_images/ICESpark-EarthCube-2022-Annual-Meeting_26_1.png" src="../../_images/ICESpark-EarthCube-2022-Annual-Meeting_26_1.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="demo-2-find-the-crossing-between-icesat-2-orbits-and-sentinel-2-and-worldview-3-images">
<h1>Demo 2:  Find the crossing between ICESat-2 orbits and Sentinel-2 and WorldView-3 images<a class="headerlink" href="#demo-2-find-the-crossing-between-icesat-2-orbits-and-sentinel-2-and-worldview-3-images" title="Permalink to this headline">#</a></h1>
<p><strong>Two Sentinel-2 image bounding boxes (lat, lon format)</strong></p>
<p>S-2 image from June 22, 2019:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UL</span><span class="p">:</span> <span class="mf">82.852919</span><span class="p">,</span> <span class="o">-</span><span class="mf">63.001439</span>
<span class="n">LL</span><span class="p">:</span> <span class="mf">81.869306</span><span class="p">,</span> <span class="o">-</span><span class="mf">63.001267</span>
<span class="n">UR</span><span class="p">:</span> <span class="mf">82.785942</span><span class="p">,</span> <span class="o">-</span><span class="mf">55.145842</span>
<span class="n">LR</span><span class="p">:</span> <span class="mf">81.810456</span><span class="p">,</span> <span class="o">-</span><span class="mf">56.080844</span>
</pre></div>
</div>
<p>Polygon format (UL - LL - LR - UR - UL): 82.852919, -63.001439, 81.869306, -63.001267, 81.810456, -56.080844, 82.785942, -55.145842, 82.852919, -63.001439</p>
<p>S-2 image from September 3, 2019:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UL</span><span class="p">:</span> <span class="mf">79.232286</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.801758</span>
<span class="n">LL</span><span class="p">:</span> <span class="mf">78.251639</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.405181</span>
<span class="n">UR</span><span class="p">:</span> <span class="mf">79.268856</span><span class="p">,</span> <span class="o">-</span><span class="mf">116.530467</span>
<span class="n">LR</span><span class="p">:</span> <span class="mf">78.285072</span><span class="p">,</span> <span class="o">-</span><span class="mf">116.569403</span>
</pre></div>
</div>
<p>Polygon format (UL - LL - LR - UR - UL): 79.232286, -121.801758, 78.251639, -121.405181, 78.285072, -116.569403, 79.268856, -116.530467, 79.232286, -121.801758</p>
<p><strong>WorldView image bounding boxes (lat, lon format)</strong></p>
<p>WV-3 image from April 10, 2019</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UL</span><span class="p">:</span> <span class="mf">79.76066207</span><span class="p">,</span> <span class="o">-</span><span class="mf">114.09955772</span>
<span class="n">LL</span><span class="p">:</span> <span class="mf">79.62275657</span><span class="p">,</span> <span class="o">-</span><span class="mf">114.06853064</span>
<span class="n">UR</span><span class="p">:</span> <span class="mf">79.83858880</span><span class="p">,</span> <span class="o">-</span><span class="mf">112.31487793</span>
<span class="n">LR</span><span class="p">:</span> <span class="mf">79.69303180</span><span class="p">,</span> <span class="o">-</span><span class="mf">112.34933739</span>
</pre></div>
</div>
<p>Polygon format (UL - LL - LR - UR - UL): 79.76066207, -114.09955772, 79.62275657, -114.06853064, 79.69303180, -112.34933739, 79.83858880, -112.31487793, 79.76066207, -114.09955772</p>
<p>WV-2 image from April 10, 2019</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UL</span><span class="p">:</span> <span class="mf">80.0576610499</span><span class="p">,</span> <span class="o">-</span><span class="mf">110.56248745</span>
<span class="n">LL</span><span class="p">:</span> <span class="mf">79.9244458799</span><span class="p">,</span> <span class="o">-</span><span class="mf">110.56242819</span>
<span class="n">UR</span><span class="p">:</span> <span class="mf">80.044587680</span><span class="p">,</span> <span class="o">-</span><span class="mf">109.42456569</span>
<span class="n">LR</span><span class="p">:</span> <span class="mf">79.9092631399</span><span class="p">,</span> <span class="o">-</span><span class="mf">109.42423191</span>
</pre></div>
</div>
<p>Polygon format (UL - LL - LR - UR - UL): 80.0576610499, -110.56248745, 79.9244458799, -110.56242819, 79.9092631399, -109.42423191, 80.044587680, -109.42456569, 80.0576610499, -110.56248745</p>
<p>WV-2 image from June 25, 2020</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UL</span><span class="p">:</span> <span class="mf">84.04474275</span><span class="p">,</span> <span class="o">-</span><span class="mf">60.80835633</span>
<span class="n">LL</span><span class="p">:</span> <span class="mf">83.90936693</span><span class="p">,</span> <span class="o">-</span><span class="mf">60.7855143</span>
<span class="n">UR</span><span class="p">:</span> <span class="mf">84.04404486</span><span class="p">,</span> <span class="o">-</span><span class="mf">59.21133579</span>
<span class="n">LR</span><span class="p">:</span> <span class="mf">83.90966186</span><span class="p">,</span> <span class="o">-</span><span class="mf">59.23332056</span>
</pre></div>
</div>
<p>Polygon format (UL - LL - LR - UR - UL): 84.04474275, -60.80835633, 83.90936693, -60.7855143, 83.90966186, -59.23332056, 84.04404486, -59.21133579, 84.04474275, -60.80835633</p>
<section id="check-if-orbits-intersect-s-2-and-or-worldview-bounding-boxes">
<h2>Check if orbits intersect S-2 and/or WorldView bounding boxes<a class="headerlink" href="#check-if-orbits-intersect-s-2-and-or-worldview-bounding-boxes" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># modified projection</span>

<span class="n">result_df1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;SELECT * &#39;</span>
                     <span class="s1">&#39;FROM is2_df &#39;</span>
                     <span class="s1">&#39;WHERE ST_Intersects(orbit, ST_PolygonFromText (</span><span class="se">\&#39;</span><span class="s1">82.852919, -63.001439,81.869306, -63.001267, 81.810456, -56.080844, 82.785942, -55.145842, 82.852919, -63.001439</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">))&#39;</span><span class="p">)</span>
<span class="n">result_df1</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sentinel-2 A number of crosses: &#39;</span><span class="p">,</span> <span class="n">result_df1</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

<span class="n">result_df2</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;SELECT * &#39;</span>
                     <span class="s1">&#39;FROM is2_df &#39;</span>
                     <span class="s1">&#39;WHERE ST_Intersects(orbit, ST_PolygonFromText (</span><span class="se">\&#39;</span><span class="s1">79.232286, -121.801758, 78.251639, -121.405181, 78.285072, -116.569403, 79.268856, -116.530467, 79.232286, -121.801758</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">))&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sentinel-2 B number of crosses: &#39;</span><span class="p">,</span> <span class="n">result_df2</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

<span class="n">result_df3</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;SELECT * &#39;</span>
                      <span class="s1">&#39;FROM is2_df &#39;</span>
                      <span class="s1">&#39;WHERE ST_Intersects(orbit, ST_PolygonFromText (</span><span class="se">\&#39;</span><span class="s1">79.76066207, -114.09955772, 79.62275657, -114.06853064, 79.69303180, -112.34933739, 79.83858880, -112.31487793, 79.76066207, -114.09955772</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">))&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WorldView A number of crosses: &#39;</span><span class="p">,</span> <span class="n">result_df3</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

<span class="n">result_df4</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;SELECT * &#39;</span>
                     <span class="s1">&#39;FROM is2_df &#39;</span>
                     <span class="s1">&#39;WHERE ST_Intersects(orbit, ST_PolygonFromText (</span><span class="se">\&#39;</span><span class="s1">80.0576610499, -110.56248745, 79.9244458799, -110.56242819, 79.9092631399, -109.42423191, 80.044587680, -109.42456569, 80.0576610499, -110.56248745</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">))&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WorldView B number of crosses: &#39;</span><span class="p">,</span> <span class="n">result_df4</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

<span class="n">result_df5</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;SELECT * &#39;</span>
                     <span class="s1">&#39;FROM is2_df &#39;</span>
                     <span class="s1">&#39;WHERE ST_Intersects(orbit, ST_PolygonFromText (</span><span class="se">\&#39;</span><span class="s1">84.04474275, -60.80835633, 83.90936693, -60.7855143, 83.90966186, -59.23332056, 84.04404486, -59.21133579, 84.04474275, -60.80835633</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">))&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WorldView C number of crosses: &#39;</span><span class="p">,</span> <span class="n">result_df5</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Stage 35:==&gt;                                                     (1 + 19) / 20]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------------------------------------+
|filename                                |
+----------------------------------------+
|IS2_RGT_0018_cycle2_29-Dec-2018.kml.csv |
|IS2_RGT_0023_cycle11_26-Mar-2021.kml.csv|
|IS2_RGT_0033_30-Dec-2018.kml.csv        |
|IS2_RGT_0018_cycle7_27-Mar-2020.kml.csv |
|IS2_RGT_0023_cycle3_30-Mar-2019.kml.csv |
|IS2_RGT_0033_cycle8_27-Jun-2020.kml.csv |
|IS2_RGT_0018_cycle6_27-Dec-2019.kml.csv |
|IS2_RGT_0023_cycle9_25-Sep-2020.kml.csv |
|IS2_RGT_0033_cycle6_28-Dec-2019.kml.csv |
|IS2_RGT_0042_cycle3_01-Apr-2019.kml.csv |
|IS2_RGT_0042_cycle7_29-Mar-2020.kml.csv |
|IS2_RGT_0018_cycle11_25-Mar-2021.kml.csv|
|IS2_RGT_0023_cycle10_25-Dec-2020.kml.csv|
|IS2_RGT_0033_cycle2_30-Dec-2018.kml.csv |
|IS2_RGT_0042_cycle11_27-Mar-2021.kml.csv|
|IS2_RGT_0042_cycle8_28-Jun-2020.kml.csv |
|IS2_RGT_0018_cycle8_26-Jun-2020.kml.csv |
|IS2_RGT_0023_cycle2_29-Dec-2018.kml.csv |
|IS2_RGT_0033_cycle7_28-Mar-2020.kml.csv |
|IS2_RGT_0042_31-Dec-2018.kml.csv        |
+----------------------------------------+
only showing top 20 rows

Sentinel-2 A number of crosses:  40
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Stage 42:===============================================&gt;        (17 + 3) / 20]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sentinel-2 B number of crosses:  10
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Stage 45:==&gt;                                                     (1 + 19) / 20]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WorldView A number of crosses:  0
WorldView B number of crosses:  0
WorldView C number of crosses:  10
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-orbits-in-year-2019-in-the-s-2-a-result">
<h2>Find orbits in Year 2019 in the S-2 A result<a class="headerlink" href="#find-orbits-in-year-2019-in-the-s-2-a-result" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_df1</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s1">&#39;filename LIKE </span><span class="se">\&#39;</span><span class="si">%2019%</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">result_df1</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Stage 54:==================================================&gt;     (18 + 2) / 20]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---------------------------------------+
|filename                               |
+---------------------------------------+
|IS2_RGT_0018_cycle6_27-Dec-2019.kml.csv|
|IS2_RGT_0042_cycle3_01-Apr-2019.kml.csv|
|IS2_RGT_0018_cycle5_28-Sep-2019.kml.csv|
|IS2_RGT_0042_cycle6_29-Dec-2019.kml.csv|
|IS2_RGT_0018_cycle3_30-Mar-2019.kml.csv|
|IS2_RGT_0042_cycle5_29-Sep-2019.kml.csv|
|IS2_RGT_0023_cycle6_28-Dec-2019.kml.csv|
|IS2_RGT_0023_cycle5_28-Sep-2019.kml.csv|
|IS2_RGT_0023_cycle3_30-Mar-2019.kml.csv|
|IS2_RGT_0033_cycle3_31-Mar-2019.kml.csv|
|IS2_RGT_0033_cycle6_28-Dec-2019.kml.csv|
|IS2_RGT_0033_cycle5_29-Sep-2019.kml.csv|
+---------------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-crossings-on-s-2-a-using-geopandas">
<h2>Visualize crossings on S-2 A using GeoPandas<a class="headerlink" href="#visualize-crossings-on-s-2-a-using-geopandas" title="Permalink to this headline">#</a></h2>
<section id="put-s-2-a-into-a-dataframe">
<h3>Put S-2 A into a DataFrame<a class="headerlink" href="#put-s-2-a-into-a-dataframe" title="Permalink to this headline">#</a></h3>
<p>You can uncomment other examples as well</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s2_a</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;SELECT ST_FlipCoordinates(ST_PolygonFromText (</span><span class="se">\&#39;</span><span class="s1">82.852919, -63.001439, 81.869306, -63.001267, 81.810456, -56.080844, 82.785942, -55.145842, 82.852919, -63.001439</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">)) as s2a&#39;</span><span class="p">)</span>
<span class="n">s2_a</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1">#s2_a = spark.sql(&#39;SELECT ST_FlipCoordinates(ST_PolygonFromText (\&#39;82.852919, -63.001439, 81.869306, -63.001267, 81.810456, -56.080844, 82.785942, -55.145842, 82.852919, -63.001439\&#39;,\&#39;,\&#39;)) as s2a&#39;)</span>
<span class="c1">#s2_b = spark.sql(&#39;SELECT ST_FlipCoordinates(ST_PolygonFromText (\&#39;79.232286, -121.801758, 78.251639, -121.405181, 78.285072, -116.569403, 79.268856, -116.530467, 79.232286, -121.801758\&#39;,\&#39;,\&#39;)) as s2b&#39;)</span>
<span class="c1"># wv_a = spark.sql(&#39;SELECT ST_FlipCoordinates(ST_PolygonFromText (\&#39;79.76066207, -114.09955772, 79.62275657, -114.06853064, 79.69303180, -112.34933739, 79.83858880, -112.31487793, 79.76066207, -114.09955772\&#39;,\&#39;,\&#39;)) as wva&#39;)</span>
<span class="c1">#s2_a.show()</span>
<span class="c1">#s2_b.show()</span>
<span class="c1">#wv_a.show()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------+
|                 s2a|
+--------------------+
|POLYGON ((-63.001...|
+--------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-result-dataframe-to-geopandas-dataframe">
<h3>Convert result DataFrame to GeoPandas DataFrame<a class="headerlink" href="#convert-result-dataframe-to-geopandas-dataframe" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">countries_df</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
<span class="c1">## Separate lines for each example</span>
<span class="n">s2_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">s2_a</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;s2a&quot;</span><span class="p">)</span>
<span class="c1">#s2_gpd = gpd.GeoDataFrame(s2_b.toPandas(), geometry=&quot;s2b&quot;)</span>
<span class="c1"># wv_gpd = gpd.GeoDataFrame(wv_a.toPandas(), geometry=&quot;wva&quot;)</span>
<span class="n">orbit_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">result_df1</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s1">&#39;ST_FlipCoordinates(orbit) as orbit&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;orbit&quot;</span><span class="p">)</span>
<span class="c1">#orbit_gpd = gpd.GeoDataFrame(result_df2.selectExpr(&#39;ST_FlipCoordinates(orbit) as orbit&#39;).toPandas(), geometry=&quot;orbit&quot;)</span>
<span class="c1"># orbit_gpd = gpd.GeoDataFrame(result_df3.selectExpr(&#39;ST_FlipCoordinates(orbit) as orbit&#39;).toPandas(), geometry=&quot;orbit&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/array.py:85: ShapelyDeprecationWarning: __len__ for multi-part geometries is deprecated and will be removed in Shapely 2.0. Check the length of the `geoms` property instead to get the  number of parts of a multi-part geometry.
  aout[:] = out
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/geodataframe.py:35: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  out = from_shapely(data)
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h3>Plot the maps<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>You can uncomment different base XY to change the view of the map</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base</span> <span class="o">=</span> <span class="n">country_gpd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;dimgray&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#d7fffe&#39;</span><span class="p">)</span>
<span class="c1"># Sentinel-2 A view</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">65</span><span class="p">,</span> <span class="o">-</span><span class="mi">54</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">85.5</span><span class="p">)</span>
<span class="c1"># Sentinel-2 B view</span>
<span class="c1">#base.set_xlim(-125, -113)</span>
<span class="c1">#base.set_ylim(72, 80)</span>
<span class="c1"># WorldView A view</span>
<span class="c1"># base.set_xlim(-115, -111)</span>
<span class="c1"># base.set_ylim(78, 81)</span>
<span class="c1"># Global view</span>
<span class="c1">#base.set_xlim(-180, 180)</span>
<span class="c1">#base.set_ylim(-90, 90)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude (degrees)&#39;</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude (degrees)&#39;</span><span class="p">)</span>
<span class="n">orbit</span> <span class="o">=</span> <span class="n">orbit_gpd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#06470c&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;IS2 RGT 1298 &amp; 1307&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">s2_gpd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">orbit</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.75</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># wv = wv_gpd.plot(ax=orbit, color=&#39;red&#39;, alpha=0.7, edgecolor=&#39;red&#39;, linewidth=1.75, label=&#39;WV-2 Image&#39;, zorder=2)</span>
<span class="c1">#plt.legend(loc=&#39;upper right&#39;, framealpha=1)</span>
<span class="c1">#plt.title(&#39;June 22, 2019 Sentinel-2 and IS-2 crossing&#39;)</span>
<span class="c1">#plt.show()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/plotting.py:38: ShapelyDeprecationWarning: Iteration over multi-part geometries is deprecated and will be removed in Shapely 2.0. Use the `geoms` property to access the constituent parts of a multi-part geometry.
  for poly in geom:
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  vertices = concatenate([
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/descartes/patch.py:64: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  [asarray(r)[:, :2] for r in t.interiors])
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/plotting.py:171: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  segments = [np.array(linestring)[:, :2] for linestring in geoms]
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  vertices = concatenate([
</pre></div>
</div>
<img alt="../../_images/ICESpark-EarthCube-2022-Annual-Meeting_38_1.png" src="../../_images/ICESpark-EarthCube-2022-Annual-Meeting_38_1.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="demo-3-find-the-crossings-between-icesat-2-orbits-and-mosaic-master-track-of-polarstern-cruise">
<h1>Demo 3: Find the crossings between ICESat-2 orbits and MOSAiC Master track of POLARSTERN cruise<a class="headerlink" href="#demo-3-find-the-crossings-between-icesat-2-orbits-and-mosaic-master-track-of-polarstern-cruise" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a UDF to clean up the data</span>
<span class="k">def</span> <span class="nf">cruise_date</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="c1">#   return s[0:10]</span>
  <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
<span class="n">spark</span><span class="o">.</span><span class="n">udf</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;cruise_date&quot;</span><span class="p">,</span> <span class="n">cruise_date</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.cruise_date(s)&gt;
</pre></div>
</div>
</div>
</div>
<section id="load-master-track-of-polarstern-cruise-into-spark">
<h2>Load Master track of POLARSTERN cruise into Spark<a class="headerlink" href="#load-master-track-of-polarstern-cruise-into-spark" title="Permalink to this headline">#</a></h2>
<p>The original data contains Leg 1- 4 including 28222065 coordinates, and has a size at 1.2 GB</p>
<p>This demo only takes a sample of 1000 records.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cruise_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;csv&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">option</span><span class="p">(</span><span class="s2">&quot;delimiter&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">option</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/PS122*head1000.txt&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="nb">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span><span class="o">.</span>\
    <span class="nb">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span><span class="o">.</span>\
    <span class="n">repartition</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">cruise_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+----------+----------+--------------------+
|    Date/Time (UTC)|  Latitude| Longitude|Flag for data source|
+-------------------+----------+----------+--------------------+
|2019-09-20T17:30:03|69.6795466|18.9966542|                   2|
|2019-09-20T17:44:29|69.6795462|18.9966490|                   2|
+-------------------+----------+----------+--------------------+
only showing top 2 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-a-dataframe-with-a-geometry-column">
<h2>Create a DataFrame with a Geometry column<a class="headerlink" href="#create-a-dataframe-with-a-geometry-column" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cruise_df</span> <span class="o">=</span> <span class="n">cruise_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="s2">&quot;ST_Point(cast(Longitude as double), cast(Latitude as double))&quot;</span><span class="p">))</span>\
<span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="s2">&quot;cruise_date(`Date/Time (UTC)`)&quot;</span><span class="p">))</span>
<span class="c1"># .filter(&quot;`Date/Time (UTC)` LIKE \&#39;2020______T__:00:00\&#39;&quot;)</span>
<span class="c1"># cruise_df.createOrReplaceTempView(&quot;cruise_df&quot;)</span>
<span class="n">cruise_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">cruise_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cruise_df</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------------+--------------------+-------+
|    Date/Time (UTC)|Flag for data source|            location|   date|
+-------------------+--------------------+--------------------+-------+
|2019-09-20T17:30:03|                   2|POINT (18.9966542...|2019-09|
|2019-09-20T17:44:29|                   2|POINT (18.996649 ...|2019-09|
+-------------------+--------------------+--------------------+-------+
only showing top 2 rows

+-----------------------------+
|location                     |
+-----------------------------+
|POINT (18.9966479 69.6795465)|
|POINT (18.9966463 69.6795468)|
+-----------------------------+
only showing top 2 rows

999
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-orbits-within-a-50km-circle-of-cruise-locations-in-year-2019-using-st-buffer">
<h2>Find orbits within a 50KM circle of cruise locations in Year 2019, using ST_Buffer<a class="headerlink" href="#find-orbits-within-a-50km-circle-of-cruise-locations-in-year-2019-using-st-buffer" title="Permalink to this headline">#</a></h2>
<p>IceSat2 data needs to be converted from WGS84 (epsg:4326) CRS to meter-based epsg:4087 (WGS 84 / World Equidistant Cylindrical) using Sedona’s ST_Transform</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_df</span> <span class="o">=</span> <span class="n">cruise_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;is2_df&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s1">&#39;filename LIKE </span><span class="se">\&#39;</span><span class="si">%2019%</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;orbit&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">),</span> <span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="nb">filter</span><span class="p">(</span><span class="s2">&quot;ST_Intersects(ST_Transform(ST_Buffer(ST_Transform(location, </span><span class="se">\&#39;</span><span class="s2">epsg:4326</span><span class="se">\&#39;</span><span class="s2">,</span><span class="se">\&#39;</span><span class="s2">epsg:3413</span><span class="se">\&#39;</span><span class="s2">), 50000), </span><span class="se">\&#39;</span><span class="s2">epsg:3413</span><span class="se">\&#39;</span><span class="s2">,</span><span class="se">\&#39;</span><span class="s2">epsg:4326</span><span class="se">\&#39;</span><span class="s2">), ST_FlipCoordinates(orbit))&quot;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">cache</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The number of crossings pairs: &#39;</span><span class="p">,</span> <span class="n">result_df</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">result_df</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># Only send 1000 rows for visualization</span>
<span class="n">result_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22/04/20 19:52:42 WARN JoinQuery: UseIndex is true, but no index exists. Will build index on the fly.
                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The number of crossings pairs:  999
+-------+-------------------+--------------------+--------------------+--------------------+
|   date|    Date/Time (UTC)|Flag for data source|            location|               orbit|
+-------+-------------------+--------------------+--------------------+--------------------+
|2019-09|2019-09-20T17:41:16|                   2|POINT (18.9966465...|LINESTRING (-0.00...|
|2019-09|2019-09-20T17:34:21|                   2|POINT (18.9966453...|LINESTRING (-0.00...|
|2019-09|2019-09-20T17:40:45|                   2|POINT (18.9966464...|LINESTRING (-0.00...|
|2019-09|2019-09-20T17:41:11|                   2|POINT (18.9966465...|LINESTRING (-0.00...|
|2019-09|2019-09-20T17:40:50|                   2|POINT (18.9966464...|LINESTRING (-0.00...|
|2019-09|2019-09-20T17:41:15|                   2|POINT (18.9966465...|LINESTRING (-0.00...|
|2019-09|2019-09-20T17:40:37|                   2|POINT (18.9966463...|LINESTRING (-0.00...|
|2019-09|2019-09-20T17:41:14|                   2|POINT (18.9966465...|LINESTRING (-0.00...|
|2019-09|2019-09-20T17:40:57|                   2|POINT (18.9966465...|LINESTRING (-0.00...|
|2019-09|2019-09-20T17:41:17|                   2|POINT (18.9966465...|LINESTRING (-0.00...|
+-------+-------------------+--------------------+--------------------+--------------------+
only showing top 10 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-the-query-result-using-geopandas">
<h2>Visualize the query result using GeoPandas<a class="headerlink" href="#visualize-the-query-result-using-geopandas" title="Permalink to this headline">#</a></h2>
<section id="convert-cruise-df-to-50km-circle">
<h3>Convert Cruise DF to 50KM circle<a class="headerlink" href="#convert-cruise-df-to-50km-circle" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert to epsg:4087 meter-based CRS</span>
<span class="c1"># Only send 1000 locations for visualization</span>
<span class="n">cruise_df_viz</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s1">&#39;ST_Transform(location, </span><span class="se">\&#39;</span><span class="s1">epsg:4326</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">epsg:3413</span><span class="se">\&#39;</span><span class="s1">) as location&#39;</span><span class="p">)</span>
<span class="c1"># cruise_df.show()</span>
<span class="c1"># # Create circles using 50KM</span>
<span class="n">cruise_df_viz</span> <span class="o">=</span> <span class="n">cruise_df_viz</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s1">&#39;ST_Buffer(location, 50000) as location&#39;</span><span class="p">)</span>
<span class="c1"># # Convert to epsg:4326 WGS84</span>
<span class="n">cruise_df_viz</span> <span class="o">=</span> <span class="n">cruise_df_viz</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s1">&#39;ST_Transform(location, </span><span class="se">\&#39;</span><span class="s1">epsg:3413</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">epsg:4326</span><span class="se">\&#39;</span><span class="s1">) as location&#39;</span><span class="p">)</span>
<span class="n">cruise_df_viz</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------+
|            location|
+--------------------+
|POLYGON ((18.7160...|
|POLYGON ((18.7160...|
|POLYGON ((18.7160...|
|POLYGON ((18.7160...|
|POLYGON ((18.7160...|
|POLYGON ((18.7160...|
|POLYGON ((18.7160...|
|POLYGON ((18.7160...|
|POLYGON ((18.7160...|
|POLYGON ((18.7160...|
+--------------------+
only showing top 10 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-to-geopandas-dataframes">
<h3>Convert to GeoPandas DataFrames<a class="headerlink" href="#convert-to-geopandas-dataframes" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">countries_df</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
<span class="n">cruise_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">cruise_df_viz</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">orbit_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">result_df</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s1">&#39;ST_FlipCoordinates(orbit) as orbit&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">toPandas</span><span class="p">(),</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;orbit&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/array.py:85: ShapelyDeprecationWarning: __len__ for multi-part geometries is deprecated and will be removed in Shapely 2.0. Check the length of the `geoms` property instead to get the  number of parts of a multi-part geometry.
  aout[:] = out
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/geodataframe.py:35: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  out = from_shapely(data)
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h3>Plot the maps<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base</span> <span class="o">=</span> <span class="n">country_gpd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#d7fffe&#39;</span><span class="p">)</span>
<span class="c1"># Close-up view</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
<span class="c1"># Global view</span>
<span class="c1"># base.set_xlim(-180, 180)</span>
<span class="c1"># base.set_ylim(-90, 90)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude (degrees)&#39;</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude (degrees)&#39;</span><span class="p">)</span>
<span class="n">orbit</span> <span class="o">=</span> <span class="n">orbit_gpd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#06470c&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">soda</span> <span class="o">=</span> <span class="n">cruise_gpd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">orbit</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/plotting.py:38: ShapelyDeprecationWarning: Iteration over multi-part geometries is deprecated and will be removed in Shapely 2.0. Use the `geoms` property to access the constituent parts of a multi-part geometry.
  for poly in geom:
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  vertices = concatenate([
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/descartes/patch.py:64: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  [asarray(r)[:, :2] for r in t.interiors])
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/geopandas/plotting.py:171: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  segments = [np.array(linestring)[:, :2] for linestring in geoms]
/Users/jiayu/.local/share/virtualenvs/gallery-icespark-yOC315wH/lib/python3.8/site-packages/descartes/patch.py:62: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  vertices = concatenate([
</pre></div>
</div>
<img alt="../../_images/ICESpark-EarthCube-2022-Annual-Meeting_52_1.png" src="../../_images/ICESpark-EarthCube-2022-Annual-Meeting_52_1.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h1>
<p>[1] Yu, J., Zhang, Z., &amp; Sarwat, M. (2019). Spatial data management in apache spark: the geospark perspective and
beyond. Geolnformatica, 23(1), 37-78.</p>
<p>[2] Stratiﬁed Ocean Dynamics of the Arctic (SODA) moorings: <a class="reference external" href="https://apl.uw.edu/project/project.php?id=soda">https://apl.uw.edu/project/project.php?id=soda</a> (Accessed: 1 March 2021)</p>
<p>[3] Markus, T., Neumann, T., Martino, A., Abdalati, W., Brunt, K., Csatho, B., Farrell, 8., Fricker, H., Gardner, A., Harding, D. and Jasinski, M., 2017. The Ice, Cloud,
and land Elevation Satellite-2 (lCESat-Z): science requirements, concept, and implementation. Remote sensing of environment, 190, pp.260-273.</p>
<p>[4] Drusch, M., Del Bello, U., Carlier, 8., Colin, 0., Fernandez, V., Gascon, F., Hoersch, B., lsola, C., Laberinti, P., Martimort, P. and Meygret, A., 2012. Sentinel-2:
ESA‘s optical high-resolution mission for GMES operational services. Remote sensing of Environment, 120, pp.25-36.</p>
<p>[5] WorldView-3 Satellite Sensor: <a class="reference external" href="https://www.satimagingcorp.com/satel%7Cite-sensors/worldview-3/">https://www.satimagingcorp.com/satel|ite-sensors/worldview-3/</a> (Accessed: 1 March
2021)</p>
<p>[6] Rex, Markus (2020): Master track of POLARSTERN cruise PS122/1 in 1 sec resolution (zipped, 43.3 MB). Alfred Wegener Institute, Helmholtz Centre for Polar
and Marine Research, Bremerhaven, PANGAEA, https:/ldoi.org/10.1594/PANGAEA.924669</p>
<p>[7] Haas, Christian (2020): Master track of POLARSTERN cruise PS122/2 in 1 sec resolution (zipped, 36.7 MB). Alfred
Wegener Institute, Helmholtz Centre for Polar and Marine Research, Bremerhaven, PANGAEA,
<a class="reference external" href="https://doi.org/10.1594/PANGAEA.924672">https://doi.org/10.1594/PANGAEA.924672</a></p>
<p>[8] Kanzow, Torsten (2020): Master track of POLARSTERN cruise PS122/3 in 1 sec resolution (zipped, 52 MB). Alfred
Wegener Institute, Helmholtz Centre for Polar and Marine Research, Bremerhaven, PANGAEA,
<a class="reference external" href="https://doi.org/10.1594/PANGAEA.924678">https://doi.org/10.1594/PANGAEA.924678</a></p>
<p>[9] Rex, Markus (2021): Master track of POLARSTERN cruise PS122/4 in 1 sec resolution (zipped, 36 MB). Alfred
Wegener Institute, Helmholtz Centre for Polar and Marine Research, Bremerhaven, PANGAEA,
<a class="reference external" href="https://doi.org/10.1594/PANGAEA.926830">https://doi.org/10.1594/PANGAEA.926830</a></p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "apache-sedona"
        },
        kernelOptions: {
            kernelName: "apache-sedona",
            path: "./chapters/ec22_yu_etal"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'apache-sedona'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="README.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">gallery</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By EarthCube Office: Supported by NSF Award Number 1928208<br/>
  
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>